@startuml Gestionar carga operativa cu-07
title Diagrama de Actividad: Gestionar Carga Operativa (CU-07)
skinparam nodesep 100 
skinparam ranksep 100
skinparam classFontSize 12
skinparam classFontName "Arial"
skinparam classAttributeIconSize 0
skinparam linetype ortho
scale 5
hide circle

' Carriles
|#Orange|Supervisor de Área|
start
:Accede al módulo "Monitor de Operaciones";

|#LightBlue|Sistema|
:Recopilar datos en tiempo real (Pedidos, Quejas, Tiempos);
:Calcular "Nivel de Estrés" por zona (Cocina, Barra, Piso);

' Visualización Semafórica
if (¿Alguna zona está en ESTADO CRÍTICO?) then (Sí, Rojo)
    :Alertar visualmente (Parpadeo/Color Rojo);
    :Sugerir redistribución de personal;
else (No, Verde)
    :Mostrar indicadores estables;
endif

:Desplegar Dashboard Interactivo;

|Supervisor de Área|
:Analizar carga de trabajo;

' Decisión de Intervención
if (¿Requiere mover personal?) then (No)
    :Salir del monitor;
    stop
else (Sí)
    :Seleccionar Empleado (Origen);
    :Arrastrar/Asignar a Zona Nueva (Destino);
    
    |Sistema|
    :Verificar Disponibilidad del Empleado;
    
    ' REGLA DE NEGOCIO: Compatibilidad de Roles
    if (¿El empleado tiene la habilidad requerida?) then (No)
        :Bloquear reasignación;
        :Mostrar Error: "Habilidad insuficiente para esta zona";
        stop
    else (Sí)
        :Calcular impacto en la zona de origen;
        if (¿Deja descubierta la zona origen?) then (Sí, Riesgo)
            :Mostrar Advertencia: "La zona origen quedará crítica";
            |Supervisor de Área|
            if (¿Confirma cambio de todas formas?) then (No)
                stop
            else (Sí)
                ' Continúa
            endif
        else (No)
            ' Continúa seguro
        endif
    endif

    |Sistema|
    :Registrar Reasignación en BD;
    :Actualizar Dashboard (Recalcular métricas);
    
    fork
        :Enviar Notificación Push al Empleado ("Nueva Asignación: Cocina");
    fork again
        :Registrar movimiento en Log de Operaciones (Transparencia);
    end fork
    
    |Supervisor de Área|
    :Visualizar el balanceo de carga actualizado;
    stop
endif

@enduml