@startuml Registrar descargo cu05
title Diagrama de Actividad: Registrar Descargo (CU-05)
skinparam nodesep 100 
skinparam ranksep 100
skinparam classFontSize 12
skinparam classFontName "Arial"
skinparam classAttributeIconSize 0
skinparam linetype ortho
scale 5
hide circle

' Carriles
|#Pink|Colaborador Operativo|
start
:Accede al detalle de una Incidencia (Sanción/Reporte);
note right
  Precondición: La incidencia debe requerir
  una respuesta o estar en estado "Notificado".
end note

:Presiona el botón "Registrar Descargo";

|#LightBlue|Sistema|
:Consultar fecha de creación/notificación de la incidencia;
:Calcular tiempo transcurrido;

' Regla de Negocio Crítica: Plazos Legales
if (¿Está dentro del plazo límite? (ej. 48h)) then (No)
    :Mostrar Error: "Plazo de respuesta vencido";
    :Sugerir contactar a RRHH presencialmente;
    stop
else (Sí)
    :Habilitar formulario de defensa;
endif

|Colaborador Operativo|
:Redactar justificación de los hechos;

' Sub-flujo de Evidencia (Reutilizable)
if (¿Tiene pruebas para adjuntar?) then (Sí)
    :Cargar fotos/capturas de pantalla;
    |Sistema|
    :Validar y adjuntar archivos;
    |Colaborador Operativo|
else (No)
    ' Continúa sin archivos
endif

:Presionar "Enviar Descargo";

|#LightBlue|Sistema|
:Validar que el texto no esté vacío;
:Guardar Descargo en Base de Datos (vinculado a la Incidencia);

' Cambio de Estado Automático
:Actualizar estado de Incidencia a **"EN DISPUTA"**;
note right
  El cambio de estado alerta al Supervisor
  de que hay una respuesta pendiente de leer.
end note

fork
    :Registrar fecha/hora exacta de recepción (Sello de tiempo);
fork again
    :Notificar al Supervisor ("Nuevo descargo recibido");
end fork

:Mostrar confirmación "Descargo enviado correctamente";
stop

@enduml