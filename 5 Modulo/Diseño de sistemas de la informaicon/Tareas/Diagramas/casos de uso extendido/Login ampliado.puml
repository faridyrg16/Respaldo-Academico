@startuml Iniciar_Sesion_CU01
skinparam activity {
    BackgroundColor<<Usuario>> Pink
    BackgroundColor<<Sistema>> LightBlue
    BorderColor Black
    FontSize 12
    FontName Arial
}
skinparam nodesep 100 
skinparam ranksep 100
skinparam classFontSize 12
skinparam classFontName "Arial"
skinparam classAttributeIconSize 0
skinparam linetype ortho
scale 5
hide circle
title Diagrama de Actividad: Iniciar Sesión (CU-01)

' Usamos carriles para separar responsabilidades
|#Pink|Usuario|
start
:Ingresa a la URL del Sistema;
:Solicita Iniciar Sesión;

|#LightBlue|Sistema|
:Muestra formulario de Login;

|Usuario|
:Ingresa Correo y Contraseña;
:Presiona "Ingresar";

|Sistema|
:Validar formato de datos;

' Decisión 1: Formato
if (¿Datos completos y válidos?) then (No)
    :Mostrar error "Campos obligatorios";
    stop
else (Sí)
    :Buscar usuario en Base de Datos;
endif

' Decisión 2: Credenciales
if (¿Credenciales coinciden?) then (No)
    :Mostrar error "Usuario/Contraseña incorrectos";
    :Incrementar contador de intentos;
    stop
else (Sí)
    :Verificar Estado de Cuenta;
endif

' Decisión 3: Estado (Crítico para tu proyecto)
if (¿Usuario está ACTIVO?) then (No)
    :Bloquear acceso;
    :Mostrar "Cuenta Desactivada";
    :Registrar intento en Log de Auditoría;
    stop
else (Sí)
    :Recuperar Rol del Usuario;
    :Generar Token de Sesión;
    
    ' Bifurcación según Rol (Switch)
    if (¿Qué rol tiene?) then (Colaborador)
        :Redirigir a Panel de Mis Incidencias;
    elseif (Supervisor)
        :Redirigir a Dashboard de Operaciones;
    else (Administrador)
        :Redirigir a Panel de Auditoría;
    endif
    
    :Mostrar Mensaje de Bienvenida;
endif

stop

@enduml